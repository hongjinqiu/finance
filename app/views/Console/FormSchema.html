<!DOCTYPE html>

<html>
<head>
<title>{{.result.formTemplate.Description}}</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script type="text/javascript">
	YUI_config = {
		debug : true,
		combine : true,
		comboBase : '/app/combo?',
		root : 'yui.3.12.0/',
		gallery: 'gallery-2013.09.18-18-49'
	};
</script>
<!-- 
<link rel="stylesheet" type="text/css" href="/app/combo?yui.3.12.0/cssreset/cssreset-min.css&yui.3.12.0/cssfonts/cssfonts-min.css&yui.3.12.0/cssbase/cssbase-min.css&gallery-2013.09.18-18-49/build/gallery-aui-skin-classic/css/gallery-aui-skin-classic-min.css&gallery-2013.09.18-18-49/build/gallery-aui-skin-base/css/gallery-aui-skin-base-min.css" />
 -->
<link rel="stylesheet" type="text/css" href="/app/combo?yui.3.12.0/cssreset/cssreset-min.css&yui.3.12.0/cssfonts/cssfonts-min.css&yui.3.12.0/cssbase/cssbase-min.css" />
<link rel="stylesheet" type="text/css" href="/public/css/global.css" />
<style type="text/css">
body {
	font-size: 12px;
}
#pagContC {
    font-size:  12px;
    vertical-align: middle;
    padding:    4px 0;
}

#pagContC img.pgControls {
    width:  auto;
    height: 12px;
    padding: 0 4px 0 4px;
    border: none;
    vertical-align: middle;
    cursor: pointer;
}

#pagContC img.yui3-pagview-disabled {
    cursor: default;
}
#pagContC .yui3-pagview-input-page {
	width: 30px;
}
</style>
<script src="/public/js/yui.3.12.0/yui/yui-min.js" type="text/javascript"></script>
<script type="text/javascript">
	var dataBo = {{.result.dataBoJson}};
	var formTemplateJsonData = {{.result.formTemplateJsonData}};
	{{if .result.dataSourceJson}}
	var dataSourceJson = {{.result.dataSourceJson}};
	{{else}}
	var dataSourceJson = null;
	{{end}}
	var gridPanelDict = {};
</script>
<script type="text/javascript" src="/app/comboview?js/dataTableExtend.js&js/columnManager.js&{{.result.formTemplate.Scripts}}"></script>
</head>

<body class="yui3-skin-sam">
	{{$tResult := .result}}
	{{range $index, $item := .result.formTemplate.FormElemLi}}
		{{if eq $item.XMLName.Local "html"}}
			{{$item.Html.Value}}
		{{end}}
		{{if eq $item.XMLName.Local "toolbar"}}
		<div>
			{{range $toolbarBoKey, $toolbarBoValue := $tResult.toolbarBo}}
				{{if eq $toolbarBoKey $item.Toolbar.Name}}
					{{$toolbarBo := $toolbarBoValue}}
					{{range $btnIndex,$btnValue := $item.Toolbar.ButtonLi}}
						{{range $subIndex,$subValue := $toolbarBo}}
							{{if eq $btnIndex $subIndex}}
								{{if $subValue.isShow}}
									{{if eq $btnValue.Mode "fn"}}
										<input type="button" value="{{$btnValue.Text}}" class="{{$btnValue.IconCls}}" onclick="{{$btnValue.Handler}}()"/>
									{{end}}
									{{if eq $btnValue.Mode "url"}}
										<input type="button" value="{{$btnValue.Text}}" class="{{$btnValue.IconCls}}" onclick="location.href='{{$btnValue.Handler}}'"/>
									{{end}}
									{{if eq $btnValue.Mode "url^"}}
										<input type="button" value="{{$btnValue.Text}}" class="{{$btnValue.IconCls}}" onclick="alert('需要用弹出{{$btnValue.Handler}}')"/>
									{{end}}
								{{end}}
							{{end}}
						{{end}}
					{{end}}
				{{end}}
			{{end}}
		</div>
		{{end}}
		{{if eq $item.XMLName.Local "column-model"}}
			{{if eq $tResult.formTemplate.DataSourceModelId ""}}
				{{if eq $item.Name ""}}
					<div id="columnModel_{{$index}}"></div>
				{{else}}
					<div id="{{$item.Name}}"></div>
				{{end}}
			{{else}}
				<div id="{{$item.DataSetId}}"></div>
			{{end}}
		<script type="text/javascript">
		YUI().use("node", "event", 'array-extras', 'querystring-stringify', "json", "datatable", "datasource-get", "datasource-jsonschema", "datatable-datasource", "datatable-sort", "datatable-scroll", "cssbutton", 'cssfonts', 'dataschema-json','datasource-io','model-sync-rest',"gallery-datatable-paginator",'gallery-paginator-view',"listtemplate-paginator","datatype-date-format", "io-base", "anim", function(Y) {
			//,"gallery-aui-calendar-datepicker-select"
			Y.on("domready", function(e) {
				var columnModel = null;
				for (var i = 0; i < formTemplateJsonData.FormElemLi.length; i++) {
					if ((i + "") == "{{$index}}") {
						columnModel = formTemplateJsonData.FormElemLi[i].ColumnModel;
						break;
					}
				}
				if (columnModel) {
					var dataTableManager = new DataTableManager();
					var dataSourceModelId = formTemplateJsonData.DataSourceModelId;
					var columnModelName = "";
					if (!dataSourceModelId) {
						if (!columnModel.Name) {
							columnModelName = "columnModel_{{$index}}";
						} else {
							columnModelName = columnModel.Name;
						}
					} else {
						columnModelName = columnModel.DataSetId;
					}
					var isRender = true;
					var isRenderList = false;
					var items = dataBo[columnModelName] || [];
					if (!dataSourceModelId) {
						isRenderList = !columnModel.DisplayMode || columnModel.DisplayMode == "list";
						isRender = isRenderList;
					} else {
						if (columnModel.DataSetId == "A") {
							isRenderList = false;
							items = dataBo[columnModelName] || {};
						} else {
							isRenderList = !columnModel.DisplayMode || columnModel.DisplayMode == "list";
						}
					}
					if (isRender) {
						if (isRenderList) {
							var param = {
								data:items,
								columnModel:columnModel,
								render:"#" + columnModelName,
								url:"",
								totalResults: dataBo.totalResults || 50,
								pageSize: 10000,
								paginatorContainer : null,
								paginatorTemplate : null
							};
							// 表格的编辑控件,需要dataSource,
							if (dataSourceJson) {
								param["dataSourceJson"] = dataSourceJson;
							}
							dataTableManager.createDataGrid(Y, param);
							gridPanelDict[columnModelName] = dataTableManager;
						} else {
							// renderForm,
						}
					}
				}
			});
		});
		</script>
		{{end}}
	{{end}}
	<div style="display: none">
		<img src="/public/galleryimages/loading_indicator.gif" title="加载中..." border="0" width="16" height="16"/>
	</div>
</body>
</html>
